/**
 * Minified wpDataTables JS controller file
 * @author cjbug@ya.ru
 * @since 28.01.2014
 */
var wpDataTables={};var wpDataTablesSelRows={};var wpDataTablesFunctions={};var wpDataTablesFixedHeaders={};var wpDataTablesUpdatingFlags={};var wpDataTablesResponsiveHelpers={};var wdtBreakpointDefinition={tablet:1024,phone:480};(function(a){a(function(){a("table.wpDataTable").each(function(){var d=a(this).data("description");var c=d.dataTableParams;if(d.responsive){wpDataTablesResponsiveHelpers[d.tableId]=false;c.fnPreDrawCallback=function(){if(!wpDataTablesResponsiveHelpers[d.tableId]){wpDataTablesResponsiveHelpers[d.tableId]=new ResponsiveDatatablesHelper(a(d.selector).dataTable(),wdtBreakpointDefinition)}};c.fnRowCallback=function(j,i,h,g){wpDataTablesResponsiveHelpers[d.tableId].createExpandIcon(j)};if(!d.editable){c.fnDrawCallback=function(){wpDataTablesResponsiveHelpers[d.tableId].respond()}}}if(typeof c.oLanguage==="undefined"){c.oLanguage={}}c.oLanguage.sProcessing='<img src="'+d.spinnerSrc+'" />';if(d.editable){if(typeof wpDataTablesFunctions[d.tableId]==="undefined"){wpDataTablesFunctions[d.tableId]={}}wpDataTablesSelRows[d.tableId]=-1;c.fnDrawCallback=function(){if(d.responsive){wpDataTablesResponsiveHelpers[d.tableId].respond()}if(wpDataTablesSelRows[d.tableId]==-2){var g=wpDataTables[d.tableId].fnSettings()._iDisplayLength-1;a(d.selector+" tbody tr").removeClass("selected");wpDataTablesSelRows[d.tableId]=wpDataTables[d.tableId].fnGetPosition(a(d.selector+" tbody tr:eq("+g+")").get(0))}else{if(wpDataTablesSelRows[d.tableId]==-3){var g=0;a(d.selector+" tbody tr").removeClass("selected");wpDataTablesSelRows[d.tableId]=wpDataTables[d.tableId].fnGetPosition(a(d.selector+" tbody tr:eq("+g+")").get(0))}}if(!a(d.selector+"_edit_dialog").is(":ui-dialog")){return}if(a(d.selector+"_edit_dialog").dialog("isOpen")){var h=wpDataTables[d.tableId].fnGetData(wpDataTablesSelRows[d.tableId]);wpDataTablesFunctions[d.tableId].applyData(h)}if(wpDataTablesUpdatingFlags[d.tableId]){a(d.selector+" tbody tr:eq("+wpDataTablesSelRows[d.tableId]+")").click()}wpDataTablesUpdatingFlags[d.tableId]=false};wpDataTablesFunctions[d.tableId].applyData=function(j){a(j).each(function(l,m){if(m){var n=m.toString()}else{var n=""}if(n.indexOf("span")!=-1){n=n.replace(/<span>/g,"").replace(/<\/span>/g,"")}if(n.indexOf("<br/>")!=-1){n=n.replace(/<br\/>/g,"\n")}if(a("#"+d.tableId+"_edit_dialog .editDialogInput:eq("+l+")").data("input_type")=="multi-selectbox"){a("#"+d.tableId+"_edit_dialog .editDialogInput:eq("+l+") option").removeAttr("selected");var k=n.split(", ");a(k).each(function(){a("#"+d.tableId+"_edit_dialog .editDialogInput:eq("+l+') option[value="'+this+'"]').attr("selected","selected")})}else{if(a("#"+d.tableId+"_edit_dialog .editDialogInput:eq("+l+")").data("input_type")=="attachment"){if(n!=""){n=a(n).attr("href");n=n.substring(n.lastIndexOf("/")+1)}}else{if(n.indexOf("<a href")!=-1){n=a(n).html()}}a("#"+d.tableId+"_edit_dialog .editDialogInput:eq("+l+")").val(n).css("border","")}});if(a(".fileupload_"+d.tableId+"").length){var h=a(".fileupload_"+d.tableId+"");h.closest(".fileinput-button").show();h.closest("td").find(".progress").show();var i=a("#"+d.tableId+"_edit_dialog tr.idRow .editDialogInput").data("key");var g=a("#"+d.tableId+"_edit_dialog tr.idRow .editDialogInput").val();a(".progress-bar").css("width","0%");a(".fileupload_"+d.tableId+"").each(function(){a(this).fileupload("option","url",d.fileUploadBaseUrl+"&key="+a(this).data("key")+"&id_key="+i+"&id_val="+g);a("#files_"+d.tableId+"_"+a(this).data("key")).html("<p>"+a("#"+d.tableId+"_"+a(this).data("key")).val()+' [<a href="#" data-key="'+a(this).data("key")+'" class="wdtdeleteFile">remove</a>]</p>');if(a("#"+d.tableId+"_"+a(this).data("key")).val()==""){a("#files_"+d.tableId+"_"+a(this).data("key")).hide()}else{a("#files_"+d.tableId+"_"+a(this).data("key")).show()}})}};wpDataTablesFunctions[d.tableId].saveTableData=function(h){if(typeof(h)===undefined){h=false}wpDataTablesUpdatingFlags[d.tableId]=true;var g={table_id:d.tableWpId};var i=true;a(d.selector+"_edit_dialog .editDialogInput").each(function(){if(a(this).data("input_type")=="email"){if(a(this).val()!=""){var j=wdtValidateEmail(a(this).val());if(!j){i=false;a(this).css("border","2px solid #f00")}else{a(this).css("border","")}}}else{if(a(this).data("input_type")=="link"){if(a(this).val()!=""){var j=wdtValidateURL(a(this).val());if(!j){i=false;a(this).css("border","2px solid #f00")}else{a(this).css("border","")}}}}if(a(this).hasClass("datepicker")){g[a(this).data("key")]=a.datepicker.formatDate("yy-mm-dd",a(this).datepicker("getDate"))}else{if(a(this).data("input_type")=="multi-selectbox"){if(a(this).val()){g[a(this).data("key")]=a(this).val().join(", ")}}else{g[a(this).data("key")]=a(this).val()}}});if(!i){return false}wpDataTablesUpdatingFlags[d.tableId]=true;a.ajax({url:d.adminAjaxBaseUrl,type:"POST",data:{action:"wdt_save_table_frontend",formdata:g},success:function(j){if(j){a(d.selector+"_edit_dialog tr.idRow .editDialogInput").val(j);if(a(".fileupload_"+d.tableId).length){a(".fileupload_"+d.tableId).closest(".fileinput-button").show();a(".fileupload_"+d.tableId).closest("td").find(".progress").show()}if(h){wpDataTables[d.tableId].fnDraw(false)}}else{wpDataTables[d.tableId].fnDraw(false)}}});return true}}wpDataTables[d.tableId]=a(d.selector).dataTable(c);if((d.columnsFixed==0)&&(d.groupingEnabled)){wpDataTables[d.tableId].rowGrouping({iGroupingColumnIndex:d.groupingColumnIndex})}if(d.advancedFilterEnabled){wpDataTables[d.tableId].columnFilter(d.advancedFilterOptions);a.datepicker.regional[""].dateFormat=d.datepickFormat;a.datepicker.setDefaults(a.datepicker.regional[""])}if(d.columnsFixed>0){wpDataTablesFixedHeaders[d.tableId]=new FixedHeader(wpDataTables[d.tableId],{left:d.columnsFixed,tableId:d.tableId,offsetLeft:d.offsetLeft,offsetTop:d.offseTop})}if(d.editable){a(d.selector+"_edit_dialog").dialog({show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},modal:true,autoOpen:false,draggable:false,width:500,height:500,dialogClass:"wdtEditDialog",buttons:{Cancel:function(){a(this).dialog("close")},"<< Prev":function(){var h=a(d.selector+" tr.selected").index();if(h>0){a(d.selector+" tbody tr.selected").removeClass("selected");a(d.selector+" tbody tr:eq("+(h-1)+")").addClass("selected",300);wpDataTablesSelRows[d.tableId]=wpDataTables[d.tableId].fnGetPosition(a(d.selector+" tbody tr.selected").get(0));var i=wpDataTables[d.tableId].fnGetData(wpDataTablesSelRows[d.tableId]);wpDataTablesFunctions[d.tableId].applyData(i)}else{var g=Math.ceil(wpDataTables[d.tableId].fnSettings()._iDisplayStart/wpDataTables[d.tableId].fnSettings()._iDisplayLength)+1;if(g==1){return}wpDataTablesSelRows[d.tableId]=-2;wpDataTablesUpdatingFlags[d.tableId]=true;wpDataTables[d.tableId].fnPageChange("previous")}},"Next >>":function(){var i=a(d.selector+" tr.selected").index();if(i<wpDataTables[d.tableId].fnSettings()._iDisplayLength-1){a(d.selector+" tbody tr.selected").removeClass("selected");a(d.selector+" tbody tr:eq("+(i+1)+")").addClass("selected",300);wpDataTablesSelRows[d.tableId]=wpDataTables[d.tableId].fnGetPosition(a(d.selector+" tbody tr.selected").get(0));var j=wpDataTables[d.tableId].fnGetData(wpDataTablesSelRows[d.tableId]);wpDataTablesFunctions[d.tableId].applyData(j)}else{var h=Math.ceil(wpDataTables[d.tableId].fnSettings()._iDisplayStart/wpDataTables[d.tableId].fnSettings()._iDisplayLength)+1;var g=Math.ceil(wpDataTables[d.tableId].fnSettings()._iRecordsTotal/wpDataTables[d.tableId].fnSettings()._iDisplayLength);if(h==g){return}wpDataTablesSelRows[d.tableId]=-3;wpDataTablesUpdatingFlags[d.tableId]=true;wpDataTables[d.tableId].fnPageChange("next");wpDataTables[d.tableId].fnDraw(false)}},Apply:function(){wpDataTablesFunctions[d.tableId].saveTableData()},OK:function(){if(wpDataTablesFunctions[d.tableId].saveTableData(true)){a(this).dialog("close")}}}});a(d.selector+"_edit_dialog input.maskMoney").maskMoney();a(d.selector+"_edit_dialog input.datepicker").datepicker();if(a(".fileupload_"+d.tableId).length){a(".fileupload_"+d.tableId).parent().button();a(".fileupload_"+d.tableId).each(function(){var g=a(this).data("key");a(this).fileupload({dataType:"json",done:function(i,h){a.each(h.result.files,function(j,k){a("#files_"+d.tableId+"_"+g).html("<p>"+k.name+' [<a href="#" data-key="'+g+'" class="wdtdeleteFile">remove</a>]</p>');a(d.selector+"_"+g).val(k.url);if(a(d.selector+"_"+g).val()==""){a(d.selector+"_"+g).hide()}else{a(d.selector+"_"+g).show()}})},progressall:function(j,i){var h=parseInt(i.loaded/i.total*100,10);a("#progress_"+d.tableId+"_"+g+" .progress-bar").css("width",h+"%")}})})}a("#edit_"+d.tableId).click(function(){var h=a(d.selector+" tr.selected").get(0);var g=wpDataTables[d.tableId].fnGetData(h);wpDataTablesFunctions[d.tableId].applyData(g);a(d.selector+"_edit_dialog").dialog("open")});a("#new_"+d.tableId).click(function(){a(d.selector+"_edit_dialog .editDialogInput").val("").css("border","");a(d.selector+"_edit_dialog tr.idRow .editDialogInput").val("0");a(d.selector+"_edit_dialog").dialog("open");if(a(".fileupload_"+d.tableId).length){var g=a(".fileupload_"+d.tableId);g.closest(".fileinput-button").hide();g.closest("td").find(".progress").hide();a("#files_"+d.tableId+"_"+g.data("key")).html("")}});a("#delete_"+d.tableId).click(function(){var g='<div title="Are you sure?">Delete this entry?</div>';a(g).dialog({autoOpen:true,dialogClass:"wdtEditDialog",modal:true,buttons:{Yes:function(){var k=a(d.selector+" tr.selected").get(0);var j=wpDataTables[d.tableId].fnGetData(k);var h=j[d.idColumnIndex];var i=this;a.ajax({url:d.adminAjaxBaseUrl,type:"POST",data:{action:"wdt_delete_table_row",id_key:d.idColumnKey,id_val:h,table_id:d.tableWpId},success:function(){wpDataTables[d.tableId].fnDraw(false);a(i).dialog("close");a(i).dialog("destroy")}})},No:function(){a(this).dialog("close");a(this).dialog("destroy")}}})});a("#edit_"+d.tableId).prependTo(d.selector+"_wrapper .DTTT_container").css("float","right");a("#new_"+d.tableId).prependTo(d.selector+"_wrapper .DTTT_container").css("float","right");a("#delete_"+d.tableId).prependTo(d.selector+"_wrapper .DTTT_container").css("float","right");var b=function(g){if(a(this).hasClass("selected")){a(d.selector+" tbody tr").removeClass("selected");wpDataTablesSelRows[d.tableId]=-1}else{a(d.selector+"  tbody tr").removeClass("selected");a(this).addClass("selected");wpDataTablesSelRows[d.tableId]=wpDataTables[d.tableId].fnGetPosition(a(d.selector+" tbody tr.selected").get(0))}if(a(d.selector+" tbody tr.selected").length>0){a("#edit_"+d.tableId).removeAttr("disabled");a("#delete_"+d.tableId).removeAttr("disabled")}else{a("#edit_"+d.tableId).attr("disabled","disabled");a("#delete_"+d.tableId).attr("disabled","disabled")}};var e=navigator.userAgent,f=(e.match(/iPad/i))?"touchstart":"click";a(d.selector+" tbody tr").live(f,b);a(d.selector+"_edit_dialog a.wdtdeleteFile").live("click",function(i){i.preventDefault();i.stopImmediatePropagation();var g='<div title="Are you sure?">Delete this file?</div>';var h=a(this).data("key");var k=a(d.selector+"_"+h);var j=a(this).closest(".files");a(g).dialog({autoOpen:true,dialogClass:"wdtEditDialog",modal:true,buttons:{Yes:function(){var l=a(d.selector+"_edit_dialog tr.idRow .editDialogInput").val();var m=this;a.ajax({url:d.adminAjaxBaseUrl,type:"POST",data:{action:"wdt_delete_uploaded_file",id_key:d.idColumnKey,id_val:l,table_id:d.tableWpId,key:h},success:function(){j.html("");k.val("");a(m).dialog("close");a(m).dialog("destroy")}})},No:function(){a(this).dialog("close");a(this).dialog("destroy")}}})})}})})})(jQuery);