(function(a){a.fn.columnFilter=function(d){var b,w,m,h;var y="From {from} to {to}";var c=new Array();var g=new Array();var x=null;var v=function(){};function z(A,D,G,J,H){if(typeof D=="undefined"){return new Array()}if(typeof G=="undefined"){G=true}if(typeof J=="undefined"){J=true}if(typeof H=="undefined"){H=true}var L;if(J==true){L=A.aiDisplay}else{L=A.aiDisplayMaster}var K=new Array();for(var C=0,F=L.length;C<F;C++){var E=L[C];var B=t.fnGetData(E);var I=B[D];if(H==true&&I.length==0){continue}else{if(G==true&&jQuery.inArray(I,K)>-1){continue}else{K.push(I)}}}return K.sort()}function u(i){if(l.bUseColVis){return i}else{return t.fnSettings().oApi._fnVisibleToColumnIndex(t.fnSettings(),i)}}function o(I,H,J,A,E,K){var B="text_filter";if(A){B="number_filter"}m=m.replace(/(^\s*)|(\s*$)/g,"");var C=I.fnSettings().aoPreSearchCols[w].sSearch;var i="search_init ";var D=m;if(C!=""&&C!="^"){if(A&&C.charAt(0)=="^"){D=C.substr(1)}else{D=C}i=""}var G=a('<input type="text" class="'+i+B+'" value="'+D+'"/>');if(K!=undefined&&K!=-1){G.attr("maxlength",K)}h.html(G);if(A){h.wrapInner('<span class="filter_column filter_number" />')}else{h.wrapInner('<span class="filter_column filter_text" />')}b[w]=m;var F=w;if(A&&!I.fnSettings().oFeatures.bServerSide){G.keyup(function(){I.fnFilter("^"+this.value,u(F),true,false);v()})}else{G.keyup(function(){if(I.fnSettings().oFeatures.bServerSide&&E!=0){var L=I.fnSettings().aoPreSearchCols[F].sSearch;var M=a(this).data("dt-iLastFilterLength");if(typeof M=="undefined"){M=0}var N=this.value.length;if(Math.abs(N-M)<E){return}else{a(this).data("dt-iLastFilterLength",N)}}I.fnFilter(this.value,u(F),H,J);v()})}G.focus(function(){if(a(this).hasClass("search_init")){a(this).removeClass("search_init");this.value=""}});G.blur(function(){if(this.value==""){a(this).addClass("search_init");this.value=b[F]}})}function f(i){h.html(p(0));var C=i.attr("id")+"_range_from_"+w;var E=a('<input type="text" class="number_range_filter" id="'+C+'" rel="'+w+'"/>');h.append(E);h.append(p(1));var B=i.attr("id")+"_range_to_"+w;var D=a('<input type="text" class="number_range_filter" id="'+B+'" rel="'+w+'"/>');h.append(D);h.append(p(2));h.wrapInner('<span class="filter_column filter_number_range" />');var A=w;g.push(w);i.dataTableExt.afnFiltering.push(function(J,H,G){if(i.attr("id")!=J.sTableId){return true}if(document.getElementById(C)==null){return true}var I=document.getElementById(C).value*1;var F=document.getElementById(B).value*1;var K=H[u(A)]=="-"?0:H[u(A)]*1;if(I==""&&F==""){return true}else{if(I==""&&K<=F){return true}else{if(I<=K&&""==F){return true}else{if(I<=K&&K<=F){return true}}}}return false});a("#"+C+",#"+B,h).keyup(function(){var G=document.getElementById(C).value*1;var F=document.getElementById(B).value*1;if(G!=0&&F!=0&&G>F){return}i.fnDraw();v()})}function q(i){var B=y.split(/[}{]/);h.html("");var D=i.attr("id")+"_range_from_"+w;var F=a('<input type="text" class="date_range_filter" id="'+D+'" rel="'+w+'"/>');F.datepicker();var C=i.attr("id")+"_range_to_"+w;var E=a('<input type="text" class="date_range_filter" id="'+C+'" rel="'+w+'"/>');for(ti=0;ti<B.length;ti++){if(B[ti]==l.sDateFromToken){h.append(F)}else{if(B[ti]==l.sDateToToken){h.append(E)}else{h.append(B[ti])}}}h.wrapInner('<span class="filter_column filter_date_range" />');E.datepicker();var A=w;g.push(w);i.dataTableExt.afnFiltering.push(function(M,J,I){if(i.attr("id")!=M.sTableId){return true}var H=F.datepicker("getDate");var G=E.datepicker("getDate");if(H==null&&G==null){return true}var L=null;try{if(J[u(A)]==null||J[u(A)]==""){return false}L=a.datepicker.parseDate(a.datepicker.regional[""].dateFormat,J[u(A)])}catch(K){return false}if(L==null){return false}if(H==null&&L<=G){return true}else{if(H<=L&&G==null){return true}else{if(H<=L&&L<=G){return true}}}return false});a("#"+D+",#"+C,h).change(function(){i.fnDraw();v()})}function r(L,D,H,A,M,J,C){if(D==null){D=z(L.fnSettings(),H,true,false,true)}var I=H;var G=L.fnSettings().aoPreSearchCols[w].sSearch;if(G==null||G==""){G=C}var i='<select class="search_init select_filter"><option value="" class="search_init">'+M+"</option>";var F=0;var B=D.length;for(F=0;F<B;F++){if(typeof(D[F])!="object"){var E="";if(escape(D[F])==G||escape(D[F])==escape(G)){E="selected "}i+="<option "+E+' value="'+escape(D[F])+'">'+D[F]+"</option>"}else{var E="";if(J){if(D[F].value==G){E="selected "}i+="<option "+E+'value="'+D[F].value+'">'+D[F].label+"</option>"}else{if(escape(D[F].value)==G){E="selected "}i+="<option "+E+'value="'+escape(D[F].value)+'">'+D[F].label+"</option>"}}}var K=a(i+"</select>");A.html(K);A.wrapInner('<span class="filter_column filter_select" />');K.change(function(){if(a(this).val()!=""){a(this).removeClass("search_init")}else{a(this).addClass("search_init")}if(J){L.fnFilter(a(this).val(),H,J)}else{L.fnFilter(unescape(a(this).val()),H)}v()});if(G!=null&&G!=""){L.fnFilter(unescape(G),H)}}function e(i,A,B,D){var C=i.fnSettings();if(A==null&&C.sAjaxSource!=""&&!C.oFeatures.bServerSide){C.aoDrawCallback.push({fn:(function(E,G,F){return function(){if(C.iDraw==2&&C.sAjaxSource!=null&&C.sAjaxSource!=""&&!C.oFeatures.bServerSide){return r(i,null,u(E),G,F,B,D)}}})(w,h,m),sName:"column_filter_"+w})}r(i,A,u(w),h,m,B,D)}function s(N,i){if(i==null){i=z(N.fnSettings(),w,true,true,true)}var E=w;var K="",P,O=i.length;var B=m.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("Â£","STERL").replace("@","AT").replace(/\s/g,"_");B=B.replace(/[^a-zA-Z 0-9]+/g,"");var L=m;if(l.sFilterButtonText!=null||l.sFilterButtonText!=undefined){L=l.sFilterButtonText}var Q=10;var I=12;var H=Math.floor(O/I);if(O%I>0){H=H+1}var A=100/H-2;var F=Q*H;if(H==1){A=20}var R='<div style="float:left; min-width: '+A+'%; " >';var S="</div>";var G=N.attr("id")+B;var D="chkBtnOpen"+G;var C=G+"-flt-toggle";K+='<button id="'+D+'" class="checkbox_filter" > '+L+"</button>";K+='<div id="'+C+'" title="'+m+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+(F)+'%; " >';K+=R;for(P=0;P<O;P++){if(P%I==0&&P!=0){K+=S+R}K+='<input class="search_init checkbox_filter" type="checkbox" id= "'+i[P]+'" name= "'+B+'" value="'+i[P]+'" >'+i[P]+"<br/>";var J=a(K);h.html(J);h.wrapInner('<span class="filter_column filter_checkbox" />');J.change(function(){var U="";var W="|";var T=a('input:checkbox[name="'+B+'"]:checked').size();a('input:checkbox[name="'+B+'"]:checked').each(function(X){if((X==0&&T==1)||(X!=0&&X==T-1)){W=""}U=U.replace(/^\s+|\s+$/g,"");U=U+a(this).val()+W;W="|"});for(var V=0;V<O;V++){if(U!=""){a("#"+i[V]).removeClass("search_init")}else{a("#"+i[V]).addClass("search_init")}}N.fnFilter(U,E,true,false);v()})}a("#"+D).button();a("#"+C).dialog({autoOpen:false,modal:true,draggable:false,hide:"blind",buttons:[{text:"Reset",click:function(){a('input:checkbox[name="'+B+'"]:checked').each(function(T){a(this).attr("checked",false);a(this).addClass("search_init")});N.fnFilter("",E,true,false);v();return false}},{text:"Close",click:function(){a(this).dialog("close")}}]});a("#"+D).click(function(){a("#"+C).dialog("open");var T=a(this);return false});var M=v;v=function(){var T=a("#"+D);M()}}function p(i){switch(i){case 0:return y.substring(0,y.indexOf("{from}"));case 1:return y.substring(y.indexOf("{from}")+6,y.indexOf("{to}"));default:return y.substring(y.indexOf("{to}")+4)}}var t=this;var n={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"};var l=a.extend(n,d);return this.each(function(){if(!t.fnSettings().oFeatures.bFilter){return}b=new Array();var D=t.fnSettings().aoFooter[0];var E=t.fnSettings().nTFoot;var B="tr";if(l.sPlaceHolder=="head:after"){var C=a("tr:first",t.fnSettings().nTHead).detach();if(t.fnSettings().bSortCellsTop){C.prependTo(a(t.fnSettings().nTHead));D=t.fnSettings().aoHeader[1]}else{C.appendTo(a(t.fnSettings().nTHead));D=t.fnSettings().aoHeader[0]}B="tr:last";E=t.fnSettings().nTHead}else{if(l.sPlaceHolder=="head:before"){if(t.fnSettings().bSortCellsTop){var C=a("tr:first",t.fnSettings().nTHead).detach();C.appendTo(a(t.fnSettings().nTHead));D=t.fnSettings().aoHeader[1]}else{D=t.fnSettings().aoHeader[0]}B="tr:first";E=t.fnSettings().nTHead}}a(D).each(function(F){w=F;var G={type:"text",bRegex:false,bSmart:true,iMaxLenght:-1,iFilterLength:0};if(l.aoColumns!=null){if(l.aoColumns.length<w||l.aoColumns[w]==null){return}G=l.aoColumns[w]}m=a(a(this)[0].cell).text();if(G.sSelector==null){h=a(a(this)[0].cell)}else{h=a(G.sSelector);if(h.length==0){h=a(a(this)[0].cell)}}if(G!=null){if(G.sRangeFormat!=null){y=G.sRangeFormat}else{y=l.sRangeFormat}switch(G.type){case"null":break;case"number":o(t,true,false,true,G.iFilterLength,G.iMaxLenght);break;case"select":if(G.bRegex!=true){G.bRegex=false}e(t,G.values,G.bRegex,G.selected);break;case"number-range":f(t);break;case"date-range":q(t);break;case"checkbox":s(t,G.values);break;case"text":default:bRegex=(G.bRegex==null?false:G.bRegex);bSmart=(G.bSmart==null?false:G.bSmart);o(t,bRegex,bSmart,false,G.iFilterLength,G.iMaxLenght);break}}});for(j=0;j<g.length;j++){var A=function(){var F=t.attr("id");if((typeof a("#"+F+"_range_from_"+g[j]).val()==="undefined")||(typeof a("#"+F+"_range_to_"+g[j]).val()==="undefined")){return l.sRangeSeparator}return a("#"+F+"_range_from_"+g[j]).val()+l.sRangeSeparator+a("#"+F+"_range_to_"+g[j]).val()};c.push(A)}if(t.fnSettings().oFeatures.bServerSide){var i=t.fnSettings().fnServerData;t.fnSettings().fnServerData=function(F,H,J){for(j=0;j<g.length;j++){var G=g[j];for(k=0;k<H.length;k++){if(H[k].name=="sSearch_"+G){H[k].value=c[j]()}}}H.push({name:"sRangeSeparator",value:l.sRangeSeparator});if(i!=null){try{i(F,H,J,t.fnSettings())}catch(I){i(F,H,J)}}else{a.getJSON(F,H,function(K){J(K)})}}}})}})(jQuery);